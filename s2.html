<!DOCTYPE html>
<html lang="es">
<head>
    <!-- ========================================================= -->
    <!-- METADATOS B√ÅSICOS                                         -->
    <!-- ========================================================= -->
    <meta charset="UTF-8">
    <title>Editor de Fotos y Memes - AI Meme Studio</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- ========================================================= -->
    <!-- ESTILOS CSS                                               -->
    <!-- ========================================================= -->
    <style>
        /* ===================================================== */
        /* RESET B√ÅSICO                                           */
        /* ===================================================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            font-family: Arial, Helvetica, sans-serif;
        }

        body {
            background: #121212;
            color: #ffffff;
            height: 100vh;
            overflow: hidden;
        }

        /* ===================================================== */
        /* LAYOUT GENERAL                                        */
        /* ===================================================== */
        #app {
            display: grid;
            grid-template-columns: 280px 1fr 300px;
            grid-template-rows: 60px 1fr;
            grid-template-areas:
                "header header header"
                "tools canvas memes";
            height: 100vh;
        }

        /* ===================================================== */
        /* HEADER                                                */
        /* ===================================================== */
        header {
            grid-area: header;
            background: linear-gradient(90deg, #ff0055, #6a00ff);
            display: flex;
            align-items: center;
            padding: 0 20px;
            font-size: 20px;
            font-weight: bold;
        }

        header span {
            font-size: 14px;
            margin-left: 10px;
            opacity: 0.8;
        }

        /* ===================================================== */
        /* PANEL DE HERRAMIENTAS                                 */
        /* ===================================================== */
        #tools {
            grid-area: tools;
            background: #1e1e1e;
            overflow-y: auto;
            padding: 15px;
            border-right: 2px solid #2a2a2a;
        }

        #tools h2 {
            font-size: 16px;
            margin-bottom: 10px;
            color: #ff66a3;
        }

        .tool-group {
            margin-bottom: 20px;
            border-bottom: 1px solid #333;
            padding-bottom: 15px;
        }

        .tool-group label {
            display: block;
            font-size: 13px;
            margin-bottom: 5px;
            opacity: 0.8;
        }

        .tool-group input[type="range"],
        .tool-group input[type="file"],
        .tool-group input[type="text"],
        .tool-group button {
            width: 100%;
            margin-bottom: 8px;
        }

        .tool-group button {
            padding: 8px;
            background: #ff0055;
            border: none;
            color: white;
            cursor: pointer;
            border-radius: 4px;
        }

        .tool-group button:hover {
            background: #ff3377;
        }

        /* ===================================================== */
        /* CANVAS CENTRAL                                       */
        /* ===================================================== */
        #canvas-container {
            grid-area: canvas;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #111;
        }

        canvas {
            background: #000;
            border: 2px solid #333;
            max-width: 100%;
            max-height: 100%;
        }

        /* ===================================================== */
        /* PANEL DE MEMES                                       */
        /* ===================================================== */
        #memes {
            grid-area: memes;
            background: #1b1b1b;
            overflow-y: auto;
            padding: 10px;
            border-left: 2px solid #2a2a2a;
        }

        #memes h2 {
            font-size: 16px;
            margin-bottom: 10px;
            color: #66ccff;
        }

        .meme-thumb {
            width: 100%;
            margin-bottom: 10px;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .meme-thumb:hover {
            border: 2px solid #66ccff;
        }

        /* ===================================================== */
        /* TEXTO MEME                                          */
        /* ===================================================== */
        #memeTextTop,
        #memeTextBottom {
            background: #222;
            border: 1px solid #444;
            color: white;
            padding: 6px;
        }

    </style>
</head>

<body>
<div id="app">

    <!-- ===================================================== -->
    <!-- HEADER                                                -->
    <!-- ===================================================== -->
    <header>
        üñºÔ∏è AI Meme Studio
        <span>Editor de fotos + memes estilo Photoshop</span>
    </header>

    <!-- ===================================================== -->
    <!-- PANEL IZQUIERDO - HERRAMIENTAS                         -->
    <!-- ===================================================== -->
    <div id="tools">

        <!-- ========================= -->
        <!-- CARGAR IMAGEN            -->
        <!-- ========================= -->
        <div class="tool-group">
            <h2>Cargar Imagen</h2>
            <input type="file" id="uploadImage" accept="image/*">
            <button onclick="resetCanvas()">Resetear</button>
        </div>

        <!-- ========================= -->
        <!-- AJUSTES B√ÅSICOS           -->
        <!-- ========================= -->
        <div class="tool-group">
            <h2>Ajustes B√°sicos</h2>

            <label>Brillo</label>
            <input type="range" min="0" max="200" value="100" id="brightness">

            <label>Contraste</label>
            <input type="range" min="0" max="200" value="100" id="contrast">

            <label>Saturaci√≥n</label>
            <input type="range" min="0" max="200" value="100" id="saturation">

            <button onclick="applyFilters()">Aplicar Filtros</button>
        </div>

        <!-- ========================= -->
        <!-- ROTACI√ìN                  -->
        <!-- ========================= -->
        <div class="tool-group">
            <h2>Transformar</h2>
            <button onclick="rotateImage(-90)">Rotar -90¬∞</button>
            <button onclick="rotateImage(90)">Rotar +90¬∞</button>
        </div>

        <!-- ========================= -->
        <!-- MEME TEXTO                -->
        <!-- ========================= -->
        <div class="tool-group">
            <h2>Texto Meme</h2>
            <input type="text" id="memeTextTop" placeholder="Texto superior">
            <input type="text" id="memeTextBottom" placeholder="Texto inferior">
            <button onclick="drawMemeText()">Aplicar Texto</button>
        </div>

        <!-- ========================= -->
        <!-- INSERTAR CARA             -->
        <!-- ========================= -->
        <div class="tool-group">
            <h2>Insertar Cara</h2>
            <input type="file" id="uploadFace" accept="image/*">
            <button onclick="enableFaceMode()">Modo Cara</button>
        </div>

    </div>

    <!-- ===================================================== -->
    <!-- CANVAS CENTRAL                                       -->
    <!-- ===================================================== -->
    <div id="canvas-container">
        <canvas id="canvas" width="800" height="600"></canvas>
    </div>

    <!-- ===================================================== -->
    <!-- PANEL DERECHO - MEMES                                 -->
    <!-- ===================================================== -->
    <div id="memes">
        <h2>Memes Populares</h2>
        <div id="memeList"></div>
    </div>

</div>

<!-- ========================================================= -->
<!-- JAVASCRIPT                                               -->
<!-- ========================================================= -->
<script>
/* ========================================================= */
/* VARIABLES GLOBALES                                        */
/* ========================================================= */
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

let baseImage = null;
let faceImage = null;
let faceMode = false;

let faceX = 200;
let faceY = 150;
let faceScale = 1;
let faceRotation = 0;

/* ========================================================= */
/* API CONFIG                                                */
/* ========================================================= */
const API_KEY = "TU_API_KEY_AQUI";

/*
   Puedes usar Unsplash:
   https://api.unsplash.com/search/photos?query=meme
*/

/* ========================================================= */
/* CARGA DE IMAGEN PRINCIPAL                                 */
/* ========================================================= */
document.getElementById("uploadImage").addEventListener("change", function(e) {
    const file = e.target.files[0];
    const img = new Image();
    img.onload = () => {
        baseImage = img;
        drawBaseImage();
    };
    img.src = URL.createObjectURL(file);
});

/* ========================================================= */
/* DIBUJAR IMAGEN BASE                                       */
/* ========================================================= */
function drawBaseImage() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    if (!baseImage) return;

    const ratio = Math.min(
        canvas.width / baseImage.width,
        canvas.height / baseImage.height
    );

    const w = baseImage.width * ratio;
    const h = baseImage.height * ratio;

    ctx.drawImage(
        baseImage,
        (canvas.width - w) / 2,
        (canvas.height - h) / 2,
        w,
        h
    );

    if (faceImage) drawFace();
}

/* ========================================================= */
/* FILTROS                                                   */
/* ========================================================= */
function applyFilters() {
    const b = document.getElementById("brightness").value;
    const c = document.getElementById("contrast").value;
    const s = document.getElementById("saturation").value;

    ctx.filter = `
        brightness(${b}%)
        contrast(${c}%)
        saturate(${s}%)
    `;

    drawBaseImage();
    ctx.filter = "none";
}

/* ========================================================= */
/* ROTAR                                                     */
/* ========================================================= */
function rotateImage(deg) {
    if (!baseImage) return;

    const rad = deg * Math.PI / 180;
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.save();
    ctx.translate(canvas.width / 2, canvas.height / 2);
    ctx.rotate(rad);
    ctx.drawImage(
        baseImage,
        -baseImage.width / 2,
        -baseImage.height / 2
    );
    ctx.restore();
}

/* ========================================================= */
/* TEXTO MEME                                                */
/* ========================================================= */
function drawMemeText() {
    drawBaseImage();

    ctx.font = "bold 40px Impact";
    ctx.fillStyle = "white";
    ctx.strokeStyle = "black";
    ctx.lineWidth = 3;
    ctx.textAlign = "center";

    const top = document.getElementById("memeTextTop").value;
    const bottom = document.getElementById("memeTextBottom").value;

    if (top) {
        ctx.fillText(top.toUpperCase(), canvas.width / 2, 50);
        ctx.strokeText(top.toUpperCase(), canvas.width / 2, 50);
    }

    if (bottom) {
        ctx.fillText(bottom.toUpperCase(), canvas.width / 2, canvas.height - 20);
        ctx.strokeText(bottom.toUpperCase(), canvas.width / 2, canvas.height - 20);
    }
}

/* ========================================================= */
/* CARGAR CARA                                               */
/* ========================================================= */
document.getElementById("uploadFace").addEventListener("change", function(e) {
    const file = e.target.files[0];
    const img = new Image();
    img.onload = () => {
        faceImage = img;
        drawBaseImage();
    };
    img.src = URL.createObjectURL(file);
});

/* ========================================================= */
/* MODO CARA                                                 */
/* ========================================================= */
function enableFaceMode() {
    faceMode = true;
}

/* ========================================================= */
/* DIBUJAR CARA                                              */
/* ========================================================= */
function drawFace() {
    if (!faceImage) return;

    ctx.save();
    ctx.translate(faceX, faceY);
    ctx.rotate(faceRotation);
    ctx.scale(faceScale, faceScale);
    ctx.drawImage(faceImage, -50, -50, 100, 100);
    ctx.restore();
}

/* ========================================================= */
/* EVENTOS MOUSE                                             */
/* ========================================================= */
canvas.addEventListener("mousemove", e => {
    if (!faceMode || !faceImage) return;
    const rect = canvas.getBoundingClientRect();
    faceX = e.clientX - rect.left;
    faceY = e.clientY - rect.top;
    drawBaseImage();
});

/* ========================================================= */
/* RESET                                                     */
/* ========================================================= */
function resetCanvas() {
    baseImage = null;
    faceImage = null;
    ctx.clearRect(0, 0, canvas.width, canvas.height);
}

/* ========================================================= */
/* CARGAR MEMES POPULARES                                    */
/* ========================================================= */
async function loadMemes() {
    try {
        const res = await fetch(
            `https://api.unsplash.com/search/photos?query=meme&per_page=12&client_id=${API_KEY}`
        );
        const data = await res.json();

        const list = document.getElementById("memeList");
        data.results.forEach(img => {
            const image = document.createElement("img");
            image.src = img.urls.small;
            image.className = "meme-thumb";
            image.onclick = () => {
                const i = new Image();
                i.onload = () => {
                    baseImage = i;
                    drawBaseImage();
                };
                i.src = img.urls.regular;
            };
            list.appendChild(image);
        });
    } catch (e) {
        console.warn("Error cargando memes:", e);
    }
}

loadMemes();

</script>
</body>
</html>
